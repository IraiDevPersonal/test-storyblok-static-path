---
// Obtiene todos los posts de la API y tipifica la prop del layout
import { fetchPosts, type PostModel } from "../../api/post";
import RootLayout from "../../components/layouts/RootLayout.astro";

// Define la forma de las props que Astro inyectará en esta página en tiempo de build
type Props = {
  post: PostModel;
};

// Le indica a Astro que pre-renderice esta página como HTML estático en tiempo de build.
// Sin esto, Astro intentaría renderizar la página en el servidor en cada request.
export const prerender = true;

// Requerida al usar rutas dinámicas ([id]) con prerender = true.
// Astro llama a esta función en tiempo de build para saber qué paths generar.
// Debe retornar un array de objetos { params, props }.
export async function getStaticPaths() {
  // Obtiene todos los posts para generar una página por cada uno
  const posts = await fetchPosts();

  // Cada objeto mapea un parámetro de URL (id) al dato (post) que se pasa como prop
  return posts.map((post) => ({
    params: { id: post.id.toString() }, // se convierte en el [id] de la URL
    props: { post }, // disponible vía Astro.props en este archivo
  }));
}

// Desestructura el post inyectado por getStaticPaths para usarlo en el template
const { post } = Astro.props;
---

<RootLayout title={post.title}>
  <div class="min-h-screen bg-linear-to-b from-zinc-950 via-black to-zinc-950">
    <div class="mx-auto max-w-5xl px-6 py-10">
      <header class="mb-6 space-y-4">
        <div class="flex items-start gap-3">
          <a
            href="/"
            aria-label="Volver"
            onclick="if (history.length > 1) { history.back(); return false; }"
            class="group mt-1 inline-flex size-10 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-white/80 transition hover:border-orange-400/30 hover:bg-orange-500/10 hover:text-orange-300 hover:shadow-[0_0_0_1px_rgba(251,146,60,0.22)_inset,0_0_28px_rgba(249,115,22,0.22)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 focus-visible:ring-offset-black"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="size-5"
            >
              <path d="M15 18l-6-6 6-6"></path>
            </svg>
          </a>

          <h1
            class="text-3xl font-semibold tracking-tight text-white first-letter:uppercase sm:text-5xl"
          >
            {post.title}
          </h1>
        </div>

        <div class="flex flex-wrap gap-2 text-xs text-white/60">
          <span
            class="inline-flex items-center gap-1.5 rounded-full border border-orange-400/20 bg-orange-500/10 px-2.5 py-1 text-orange-200 shadow-[0_0_0_1px_rgba(251,146,60,0.10)_inset]"
          >
            <span class="size-1.5 rounded-full bg-orange-400/80"></span>
            Post #{post.id}
          </span>
          <span
            class="inline-flex items-center gap-1.5 rounded-full border border-orange-400/20 bg-orange-500/10 px-2.5 py-1 text-orange-200 shadow-[0_0_0_1px_rgba(251,146,60,0.10)_inset]"
          >
            <span class="size-1.5 rounded-full bg-orange-400/80"></span>
            User #{post.userId}
          </span>
        </div>
      </header>

      <main
        class="rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.04)_inset] sm:p-8"
      >
        <h2 class="text-sm font-semibold tracking-wide text-white/70">
          Descripción
        </h2>
        <p class="mt-3 text-sm leading-7 text-white/75 sm:text-base">
          {post.body}
        </p>
      </main>
    </div>
  </div>
</RootLayout>
