---
// Obtiene todos los posts de la API y tipifica la prop del layout
import { fetchPosts, type PostModel } from "../../api/post";
import RootLayout from "../../components/layouts/RootLayout.astro";

// Define la forma de las props que Astro inyectará en esta página en tiempo de build
type Props = {
  post: PostModel;
};

// Le indica a Astro que pre-renderice esta página como HTML estático en tiempo de build.
// Sin esto, Astro intentaría renderizar la página en el servidor en cada request.
export const prerender = true;

// Requerida al usar rutas dinámicas ([id]) con prerender = true.
// Astro llama a esta función en tiempo de build para saber qué paths generar.
// Debe retornar un array de objetos { params, props }.
export async function getStaticPaths() {
  // Obtiene todos los posts para generar una página por cada uno
  const posts = await fetchPosts();

  // Cada objeto mapea un parámetro de URL (id) al dato (post) que se pasa como prop
  return posts.map((post) => ({
    params: { id: post.id.toString() }, // se convierte en el [id] de la URL
    props: { post }, // disponible vía Astro.props en este archivo
  }));
}

// Desestructura el post inyectado por getStaticPaths para usarlo en el template
const { post } = Astro.props;
---

<RootLayout title={post.title}>
  <header class="p-8 space-y-4">
    <h1 class="text-5xl font-bold first-letter:uppercase">{post.title}</h1>
    <div class="text-gray-300">Post ID: {post.id}</div>
    <div class="text-gray-300">User ID: {post.userId}</div>
  </header>
  <main class="px-8">
    <h5 class="text-xl font-medium">Descripción:</h5>
    <p class="text-lg text-gray-300">{post.body}</p>
  </main>
</RootLayout>
