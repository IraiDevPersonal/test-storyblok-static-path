---
import type { GetStaticPaths } from "astro";
import { useStoryblokApi } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import { isPreview } from "../lib/utils";

type Props = {
  story: any;
};

export const prerender = true;

export const getStaticPaths = (async () => {
  const storyblokApi = useStoryblokApi();
  const { data } = await storyblokApi.get("cdn/stories", {
    version: isPreview ? "draft" : "published",
  });

  return data.stories.map((story: any) => ({
    params: {
      slug: story.slug,
    },
    props: { story },
  }));
}) satisfies GetStaticPaths;

const { story } = Astro.props;
---

<StoryblokComponent blok={story.content} />
